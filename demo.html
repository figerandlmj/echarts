<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="css/common.css">
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <title>首页</title>
    </head>
    <body>
        <div id="left" class="fl">
            <div class="container">
                <div class="personal">
                    <img src="images/avatar.png" title="" alt="头像" width="86" height="86"/>
                    <p>王丽莉admin</p>
                </div>
                <ul class="banner">
                    <li class="one">
                        <span class="icon01"></span>
                        <em>用户管理</em>
                        <span class="arrow"></span>
                    </li>
                    <ul class="two-banner">
                        <li class="hover">用户信息维护</li>
                        <li>用户账户维护</li>
                        <li>用户手续费维护</li>
                    </ul>
                    <li class="one">
                        <span class="icon02"></span>
                        <em>商户管理</em>
                        <span class="arrow"></span>
                    </li>
                    <ul class="two-banner">
                        <li class="hover">商户开户</li>
                        <li>商户认证审核</li>
                        <li>商户信息维护</li>
                        <li>商户账户维护</li>
                    </ul>
                    <li class="one">
                        <span class="icon03"></span>
                        <em>订单管理</em>
                        <span class="arrow"></span>
                    </li>
                    <ul class="two-banner">
                        <li class="hover">商品订单查询</li>
                        <li>充值订单查询</li>
                        <li>提现订单查询</li>
                        <li>退款订单查询</li>
                        <li>转账订单查询</li>
                        <li>红包订单查询</li>
                    </ul>
                    <li class="one">
                        <span class="icon04"></span>
                        <em>短信/邮件</em>
                        <span class="arrow hover"></span>
                    </li>
                    <ul class="two-banner">
                        <li class="hover">短信发送日志</li>
                        <li>邮件发送日志</li>
                    </ul>
                    <li class="one">
                        <span class="icon05"></span>
                        <em>报表中心</em>
                        <span class="arrow"></span>
                    </li>
                    <ul class="two-banner">
                        <li class="hover">商户每日交易表</li>
                        <li>商户每月交易表</li>
                        <li>用户每日交易表</li>
                        <li>用户每月交易表</li>
                        <li>商户交易结算表</li>
                    </ul>
                </ul>
            </div>
        </div>
        <div id="right" class="fr">
            <div class="container">
                <div id="top">
                    <div class="fl">
                        <a href="#">
                            <span class="icon"></span>
                            <em>首页</em>
                        </a>
                    </div>
                    <div class="fr">
                        <em>上次登录时间：2016-04-06&nbsp;&nbsp;&nbsp;&nbsp;登录次数  6</em>
                        <a href="#" class="blue-bg">修改密码</a>
                        <a href="javascript:void(0);" class="red-bg">退出</a>
                    </div>
                </div>
                <div id="main" style="position:relative;background:#fff;">
                    <div class="title">
                        <span></span>
                        <em>四川省APP注册量</em>
                    </div>
                    <!-- 地图 -->
                    <div id="echarts" style="margin-left:200px;"></div>
                    <div id="loading" style="width: 80%;height: 700px;margin: 0 auto;display:none;background:#fff;opacity:0.5;"></div>
                    <!-- 其他 -->
                    <div class="map01" style="position:absolute;left:40px;top:120px;z-index:999;">
                        <img src="images/map01.png" title="" alt="" width="231" height="255"/>
                        <span style="font-size:14px;color:#000;position:absolute;left:40px;top:120px;">外省</span>
                    </div>
                    <div class="map02" style="position:absolute;left:100px;top:400px;z-index:999;">
                        <img src="images/map01.png" title="" alt="" width="231" height="255"/>
                        <span style="font-size:14px;color:#000;position:absolute;left:40px;top:120px;">未知</span>
                    </div>
                    <!-- 数据显示 -->
                    <div style="position:absolute;left:140px;top:120px;width:260px;height:154px;background:#000;opacity:0.58;padding:10px;color:#fff;border-radius:4px;z-index:9999;display:none;" class="map01-data">外省<br/>
                        <div style="margin-top:10px;">
                            注册用户： 100  / 1000<br/>
                            注册商户：200 / 2000<br/>
                            消费订单（笔）： 300 / 3000<br/>
                            <p style="padding:4px 0px;margin-bottom:4px;border-bottom:1px solid #aaa;"></p>
                            消费总金额（元）： 
                            <em style="color:#fbf809;"> 6000</em><br/>
                            历史总金额（元）：
                            <em style="color:#fbf809;" >70000</em>
                        </div>
                    </div>
                    <div style="position:absolute;left:160px;top:400px;width:260px;height:154px;background:#000;opacity:0.58;padding:10px;color:#fff;border-radius:4px;z-index:9999;display:none;" class="map02-data">外省<br/>
                        <div style="margin-top:10px;">
                            注册用户： 100  / 1000<br/>
                            注册商户：200 / 2000<br/>
                            消费订单（笔）： 300 / 3000<br/>
                            <p style="padding:4px 0px;margin-bottom:4px;border-bottom:1px solid #aaa;"></p>
                            消费总金额（元）： 
                            <em style="color:#fbf809;"> 6000</em><br/>
                            历史总金额（元）：
                            <em style="color:#fbf809;" >70000</em>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <script src="js/jquery-2.1.4.min.js"></script>
        <script src="js/echarts.js"></script>
        <script type="text/javascript" src="js/common.js"></script>
        <script type="text/javascript">
        $(function(){
            // 外省和未知
            $(".map01").hover(function(){
                $(this).find("img").attr("src","images/map01_hover.png");
                $(".map01-data").show();
            },function(){
                $(this).find("img").attr("src","images/map01.png");
                $(".map01-data").hide();
            })
            $(".map02").hover(function(){
                $(this).find("img").attr("src","images/map01_hover.png");
                $(".map02-data").show();
            },function(){
                $(this).find("img").attr("src","images/map01.png");
                $(".map02-data").hide();
            })
            // 侧边栏导航
            $(".banner .one").on("click",function(){
                $(this).toggleClass("hover");
                if($(this).next(".two-banner").is(":visible")){
                    $(this).next(".two-banner").slideUp();
                }else{
                    $(this).next(".two-banner").siblings(".two-banner").slideUp();
                    $(this).siblings(".banner .one").removeClass("hover");
                    $(this).next(".two-banner").slideDown();
                }
            })
            // 加上区县地图重绘
            var cityMap = {
                "成都市": "510100",
                "自贡市": "510300",
                "攀枝花市": "510400",
                "泸州市": "510500",
                "德阳市": "510600",
                "绵阳市": "510700",
                "广元市": "510800",
                "遂宁市": "510900",
                "内江市": "511000",
                "乐山市": "511100",
                "南充市": "511300",
                "眉山市": "511400",
                "宜宾市": "511500",
                "广安市": "511600",
                "达州市": "511700",
                "雅安市": "511800",
                "巴中市": "511900",
                "资阳市": "512000",
                "阿坝藏族羌族自治州": "513200",
                "甘孜藏族自治州": "513300",
                "凉山彝族自治州": "513400"
            };
              
              // 路径配置
            require.config({
                paths: {
                    echarts: 'echart'
                }
            });
              
            // 使用
            require(
                [
                  'echarts',
                  'echarts/chart/map' // 使用地图就加载map模块
                ],
                function(ec) {
                    // 基于准备好的dom，初始化echarts图表
                    var myChart = ec.init(document.getElementById('echarts'));

                    var curIndx = 0;
                    var mapType = [];
                    var mapGeoData = require('echarts/util/mapData/params');
                    console.log(mapGeoData)
                    for (var city in cityMap) {
                        mapType.push(city);
                        // 自定义扩展图表类型
                        mapGeoData.params[city] = {
                            getGeoJson: (function(c) {
                                var geoJsonName = cityMap[c];
                                return function(callback) {
                                    $.getJSON('echart/geoJson/china-main-city/' + geoJsonName + '.json', callback);
                                }
                            })(city)
                        }
                    }

                    // 用户总数、商户总数、订单总数
                    var users=20000,businesses=10000,orders=30000;

                    // 数据依次为用户、商户、订单、消费总金额、历史总金额
                    var data=[
                        // 市级数据
                        {name: '甘孜藏族自治州', users: 200,businesses:300,orders:400,spendMoney:500,historyMoney:600},
                        {name: '阿坝藏族羌族自治州', users: 300,businesses:400,orders:500,spendMoney:600,historyMoney:700}
                    ];
                  
                    //绑定鼠标选中事件
                    var ecConfig = require('echarts/config');
                    var num = 0;
                    myChart.on(ecConfig.EVENT.MAP_SELECTED, function(param) {
                        console.log(param);
                        var mt = param.target;
                        var len = mapType.length;
                        var flag = false;
                        for (var i = 0; i < len; i++) {
                            if (mt == mapType[i]) {
                                flag = true;
                                mt = mapType[i]; 
                            }
                        }
             
                        console.log(num);
                        if (!flag || num == 2) {
                            mt = '四川';
                            option.title.subtext = '点击查看区县注册量信息';
                            num = 0;
                            $(".map01,.map02").show();
                        }else{
                            $(".map01,.map02,#echarts").hide();
                            $("#loading").show();
                            var zrender = require('zrender');
                            var zr = zrender.init(document.getElementById('loading'));
                            var CircleShape = require('zrender/shape/Circle');
                            zr.render();
                            require([
                                'zrender/loadingEffect/Bar',
                                'zrender/loadingEffect/Bubble',
                                'zrender/loadingEffect/DynamicLine',
                                'zrender/loadingEffect/Ring',
                                'zrender/loadingEffect/Spin',
                                'zrender/loadingEffect/Whirling'
                                ],
                                function(BarEffect,BubbleEffect,DynamicLineEffect,RingEffect,Spineffect,WhirlingEffect){
                                    var effectList = new WhirlingEffect();
                                    zr.showLoading(effectList);
                                }
                            )

                            option.title.subtext = mt + ' （点击地图返回）';
                            // 根据市级参数mt来加载区县级数据
                            var data02=[
                                // 区县级数据
                                {name: '石渠县', users: 700,businesses:400,orders:500,spendMoney:600,historyMoney:700},
                                {name: '阿坝县', users: 700,businesses:400,orders:500,spendMoney:600,historyMoney:700}
                            ];
                            data=data.concat(data02);

                            setTimeout(function(){
                                $("#loading").hide();
                                $("#echarts").show();
                            },2000)

                        }
                        option.series[0].mapType = mt;
                        myChart.setOption(option, true);
                    });

                    option = {
                        title: {
                            text: '四川省',
                            subtext: '点击查看区县注册量信息',
                            x: 'center',
                            padding:0,
                            subtextStyle:{
                                color:"#000"
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: function (params) {
                                var value01,value02,value03,value04,value05;
                                for(var i=0;i<data.length;i++){
                                    if(data[i].name==params.name){
                                        value01=data[i].users;
                                        value02=data[i].businesses;
                                        value03=data[i].orders;
                                        value04=data[i].spendMoney;
                                        value05=data[i].historyMoney;
                                    }
                                }
                                return '<div style="padding:10px;">'+params.name+'<br/><div style="margin-top:10px;">注册用户： '+value01+'  / '+users+'<br/>注册商户：'+value02+' / '+businesses+'<br/>消费订单（笔）： '+value03+' / '+orders+'<br/><p style="padding:4px 0px;margin-bottom:4px;border-bottom:1px solid #aaa;"></p>消费总金额（元）： <em style="color:#fbf809;"> '+value04+'</em><br/>历史总金额（元）：<em style="color:#fbf809;" >'+value05+'</em></div></div>';
                            }
                        },
                        series: [{
                            name: '四川省APP注册量',
                            type: 'map',
                            mapType: '四川',
                            selectedMode: 'multiple',
                            itemStyle:{
                                normal:{label:{show:true}},
                                emphasis: {                 // 也是选中样式
                                    borderWidth:1,
                                    borderColor:'#59beed',
                                    color: '#59beed',
                                    label: {
                                        show: true,
                                        textStyle: {
                                            color: '#000'
                                        }
                                    }
                                }
                            },
                            data: data
                        }]
                    };
                    // 为echarts对象加载数据 
                    myChart.setOption(option);
                }
            );

        })
        </script>
    </body>
</html>